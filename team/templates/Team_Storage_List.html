{% extends 'index.html' %}

{% block title %}Team Storage List Page{% endblock %}

{% block content %}

<body class="p">
    <div class="directory-list">
        <nav>
            <h1 class="na">Team Storage List</h1>
        </nav>
        <div id="list" style="margin-left:350px; margin-right:100px;">
            <input class="b1 fr" type="button" id="create_ts" value="Create Team Storage"
                onclick="location.href='/team/team_storage_create'">
            <input class="b1 fr" type="button" value="Exit Team Storage" onclick="exit_ts();">
            {% if data %}
            <table class="table">
                <thead>
                    <th class="storageAll"><input type="checkbox" id="check_all" onclick="check_all();">
                    <label for="check_all">　　Storage</label></th>
                </thead>
                <tbody>
                    {% for list in data %}
                    <tr>
                        {% if list.master %}
                        <td></td>
                        <td>
                            <h3><a href='/movetots?name={{list.storage_name}}'>{{list.storage_name}}
                                    [{{list.master}}]</a></h3>
                        </td>
                        {% else %}
                        <td><input type='checkbox' name='ts_check' value='{{list.storage_name}}'></td>
                        <td>
                            <h3><a href='/movetots?name={{list.storage_name}}'>{{list.storage_name}}</a></h3>
                        </td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            {% else %}
            <h4 class="text-center" style="color:#ffc107;">참여한 Team Storage가 없습니다</h4>
            {% endif %}
        </div>
</body>


<script>
    window.onpageshow = function (event) {
        if (event.persisted || (window.performance && window.performance.navigation.type == 2)) {
            location.href = "{% url 'team_storage' %}";
        }
    }
    function check_all() {
        var checkbox = $('input[name=ts_check]');
        if ($('#check_all').prop("checked")) {
            checkbox.prop("checked", true);
        } else {
            checkbox.prop("checked", false);
        }
    }

    function exit_ts() {
        var ts_array = new Array();

        // check 항목 받아옴
        $("input:checkbox[name=ts_check]:checked").each(function () {
            ts_array.push($(this).val());
        })

        var formData = new FormData();

        var array = JSON.stringify({ 'array': ts_array })

        formData.append('tsname', array);

        if (confirm("정말 탈퇴하시겠습니까?")) {
            $.ajax({
                url: "{% url 'tsexit' %}",
                data: formData,  //위에서 선언한 fromdata
                processData: false,  // 데이터 객체를 문자열로 바꿀지에 대한 값이다. true면 일반문자...
                contentType: false,  // 해당 타입을 true로 하면 일반 text로 구분되어 진다.
                type: 'POST',
                success: function (result) {
                    alert("탈퇴가 완료되었습니다.");
                    location.reload();
                },
                error: function (request, status, error) {
                    alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                }
            });
        }
    }
</script>

{% endblock %}