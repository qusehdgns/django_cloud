{% load static %}
<script src="{% static 'js/main/jquery.min.js' %}"></script>
<script src="/static/js/main/popper.js"></script>
<script src="{% static 'js/main/bootstrap.min.js' %}"></script>
<script src="{% static 'js/main/main.js' %}"></script>

<head>
    <meta charset="utf-8">
    <meta name="viewport"
        content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>{% block title %}{% endblock %}</title>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
    
    <link rel="stylesheet" type="text/css" href="{% static 'css/main/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/main/profile.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/personal/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/personal/PS_File_Upload.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/team/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/team/Team_Storage_Create.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/team/Team_Storage_List.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/master/TS_Master.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/master/TS_Notice_Upload.css' %}">
    <link rel=stylesheet href=//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css>
    <script src="https://kit.fontawesome.com/9bd2dd9e87.js" crossorigin="anonymous"></script>
    <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="/static/js/main/pushy.js"></script>
    <script src="https://use.fontawesome.com/08a9781b65.js" type="text/javascript"></script>
</head>

<body id="aabb">
    <div class="wrapper d-flex align-items-stretch">
        <nav id="sidebar" class="pushy pushy-left">
            <div class="p-4 pt-5">
                <button  id="sidebarCollapse1" class="testtest1 side-left-pushy-button">
                    <img style="width:25px; height:25px;" src="/static/img/iconmonstr-menu-1-240.png">
                </button> 
                <div>
                    <img class="img logo rounded-circle mb-3" id="emo" src=""></img>
                    <span class="name" id="userid"></div></span>

                <h3 class="aa" onclick="select_else();"><span onclick="location.href='/profile';">Mypage</span></h3>
                　|　
                <h3 class="aa1" onclick="select_else();"><a style="color: gray;" href="{% url 'logout' %}">Logout</a>
                </h3>
            </div>

            <ul class="p-4 pt-5 list-unstyled components mb-5">
                <li id="ps" onclick='select_index(this);'>
                    <a id="ps_name" href="{% url 'personal_storage' %}"></a>
                </li>
                <li>
                    <div id="tsl" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);"
                        onclick='select_index(this);'>
                        <a style="display:inline-block; width:91%; border:none;"
                            href="{% url 'team_storage_list' %}">Team Storage </a>
                        <a class="plus" style="display:inline; border:none; cursor:hand; margin-top:20px;" id="ts_list">
                            <svg style="margin-left:0px;" width="1em" height="1em" viewBox="0 0 16 16"
                                class="bi bi-plus-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                    d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z" />
                            </svg>
                        </a>
                    </div>
                    {% comment %} <span id="ts_list" style="cursor:hand;">Team Storage</span> {% endcomment %}

                    <ul class="list-unstyled" id="pageSubmenu"></ul>
                </li>
            </ul>

        </nav>
    </div>

    <div id="content">
        {% block content %}
        {% endblock %}
    </div>
</body>


<script>
    $('#sidebarCollapse').on('click', function () {
        $('#sidebar').toggleClass('active');

    });
    $('#sidebarCollapse1').on('click', function () {
        $('#sidebar').toggleClass('active');

    });
    // 초기 사용자 id 및 이름 가져오기
    $.ajax({
        url: "{% url 'index' %}",
        type: 'GET',
        async: false,   // 순차적 진행
        success: function (result) {
            $('#emo').attr("src", "/static/img/" + result.user.useremo + ".jpg");
            $('#userid').text(result.user.userid + "  (" + result.user.username + ")");
            $('#username').text(result.user.username);
            $('#ps_name').text(result.user.userid + "'s Storage");

            for (var i in result.storage) {
                if (result.storage[i].master) {
                    var temp = "<li id='" + i + "' onclick='select_index(this);'><a href='/movetots?name=" + result.storage[i].storage_name + "'>" + " [" + result.storage[i].master + "]" + result.storage[i].storage_name + "</a></li>";
                } else {
                    var temp = "<li id='" + i + "' onclick='select_index(this);'><a href='/movetots?name=" + result.storage[i].storage_name + "'>" + result.storage[i].storage_name + "</a></li>";
                }
                $('#pageSubmenu').append(temp);
            }

            if (result.select != "none") {
                $('#' + result.select).children().eq(0).css('color', '#ffc107');
            }
        },
        error: function (request, status, error) {
            alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
        }
    });

    // personal storage 문구 클릭 액션
    $('#ps').click(function () {
        location.href = "{% url 'personal_storage' %}";
    });

    // team storage list 문구 클릭 액션
    $('#ts_list').click(function () {
        location.href = "{% url 'team_storage_create' %}";
    });

    function select_index(obj) {
        var id = $(obj).attr('id');
        $.ajax({
            url: "{% url 'selectindex' %}",
            type: "GET",
            async: false,   // 순차적 진행
            data: { "select": id },
            error: function (request, status, error) {
                alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
            }
        })
    }

    function select_else() {
        $.ajax({
            url: "{% url 'selectindex' %}",
            type: "GET",
            async: false,   // 순차적 진행
            data: { "select": "none" },
            error: function (request, status, error) {
                alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
            }
        })
    }
</script>