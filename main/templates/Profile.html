{% extends 'index.html' %}

{% block title %}Profile Page{% endblock %}
{% block content %}
<style>
    .profile {
        margin: auto;
        width: 100%;
        height: 40%;
    }

    .left-box {
        float: left;
        width: 30%;
    }

    .right-box {
        float: right;
        width: 50%;
    }
</style>

<body>
    <h1>{{userid}}'s Profile</h1>
    <div class='profile'>
        <div class='left-box'>
            <div>
                <img src="/static/img/{{useremo}}.jpg">
            </div>
            <p></p>
            <input type="button" value="Select Emoticon" id="selectemo" onclick="select_emoticon();">
        </div>

        <div id="value" class='right-box'>
            <p>
            <h4>아이디 : {{userid}}</h4>
            </p>
            <p>
            <h4>이름 : {{username}}</h4>
            </p>
            <p>
            <h4>전화번호 : {{userphone}}</h4>
            </p>
            <input type="button" value="Reset PW" onclick="location.href='/movetoresetpw'">
            <input type="button" value="Change" id="change">
            <input type="button" value="Delete User" onclick="delete_user();">
        </div>
        <div class='right-box' id="changevalue">
            <p>
            <h4>아이디 : {{userid}}</h4>
            </p>
            <p>이름 : <input type="text" value="{{username}}" id="name"></p>
            <p>전화번호 : <input type="text" value="{{userphone}}" id="phone"></p>
            <input type="button" value="확인" id="accept" onclick="change_profile();">
            <input type="button" value="취소" id="cancel">
        </div>
    </div>

    <div class="ts-master-list">
        <h1>My Team Storage List</h1>
        <table>
            <tbody>
                {% if data %}
                {% for list in data %}
                <tr>
                    <td>
                        <h3><a href="/movetotsmaster?ts_name={{list}}">{{list}}</a></h3>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td>{{userid}}님이 만든 Team Storage가 없습니다.</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    <div id="emo_dialog" title="Change Emoticon" style="display: none;">
        <h4>Select Emoticon</h4>
        <span><input type="radio" name="choose_emo" value="dog"><img src="/static/img/dog.jpg"></span>
        <span><input type="radio" name="choose_emo" value="cat"><img src="/static/img/cat.jpg"></span>
        <span><input type="radio" name="choose_emo" value="bear"><img src="/static/img/bear.jpg"></span>
        <span><input type="radio" name="choose_emo" value="peach"><img src="/static/img/peach.jpg"></span>
        <span><input type="radio" name="choose_emo" value="rabbit"><img src="/static/img/rabbit.jpg"></span>
    </div>
</body>

<script>
    $('#changevalue').hide();
    $('#selectemo').hide();

    $('#change').click(function () {
        $('#value').hide();

        $('#changevalue').show();
        $('#selectemo').show();
    });

    $('#cancel').click(function () {
        $('#changevalue').hide();
        $('#selectemo').hide();

        $('#value').show();
    });

    function change_profile() {
        var username = $('#name').val();
        var userphone = $('#phone').val();

        if (confirm("정말 수정하시겠습니까?")) {
            $.ajax({
                url: "{% url 'changeprofile' %}",
                type: "GET",
                data: { 'username': username, 'userphone': userphone },
                success: function (result) {
                    if (result == 'success') {
                        alert("수정 완료 되었습니다.");
                        location.reload();
                    }
                },
                error: function (request, status, error) {
                    alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                }
            })
        }
    }

    function delete_user() {
        if (confirm("정말 탈퇴하시겠습니까?")) {
            var quest = prompt("Delete를 입력해주세요.")
            if (quest == "Delete") {
                $.ajax({
                    url: "{% url 'deleteuser' %}",
                    type: "GET",
                    success: function (result) {
                        if (result == "success") {
                            alert("탈퇴가 완료되었습니다.");
                            location.href = "{% url 'logout' %}";
                        } else {
                            alert("마스터로 존재하는 팀스토리지가 있습니다.\n마스터를 넘겨주세요.");
                        }
                    },
                    error: function (request, status, error) {
                        alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                    }
                })
            } else {
                alert("올바르게 입력해주세요.");
            }
        }
    }

    function select_emoticon(){
        $("input:radio[name ='choose_emo']:input[value='{{useremo}}']").prop("checked", true);
        $('#emo_dialog').dialog({
            width: 'auto',
            modal: true,
            buttons: {
                "Change": function () {
                    var emo = $('input[name="choose_emo"]:checked').val();

                    if(emo == "{{useremo}}"){
                        alert("현재와 동일한 이모티콘입니다.");
                    }else{
                        $.ajax({
                                    url: "{% url 'changeemo' %}",
                                    type: "GET",
                                    data: { "emo" : emo },
                                    success: function (result) {
                                        alert(result);
                                        location.reload();
                                    },
                                    error: function (request, status, error) {
                                        alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                                    }
                                })
                    }
                },
                "close": function () {
                    $(this).dialog('close');
                }
            }
        })
    }
</script>
{% endblock %}