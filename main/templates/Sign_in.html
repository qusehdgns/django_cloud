<head>
    <meta name="viewport"
        content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>Sign in Page</title>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
</head>

<body>
    <div>
        <h1>Sign in</h1>
        <form method="POST" action="{% url 'sign_in' %}" id="user_form">
            {% csrf_token %}
            ID :
            <input id="userid" name="userid" type="text" onchange="change_val();" placeholder="ID">
            <input type="button" value="ID Check" onclick="id_check();">
            <br>
            PW :
            <input id="userpw" name="userpw" type="password" placeholder="Password">
            <br>
            PW Again :
            <input id="userpw_again" name="userpw_again" type="password" placeholder="Password Again">
            <br>
            Name :
            <input id="username" name="username" type="text" placeholder="Name">
            <br>
            Phone :
            <input id="userphone" name="userphone" type="text" maxlength="13" placeholder="Phone number">
            <br>
            <input type="button" value="Sign in" onclick="sign_in();">
            <input type="button" value="Go to Login" onclick="location.href = '/';"
        </form>
    </div>
</body>

<script>
    var checked = false;

    function change_val() {
        checked = false;
    }

    function id_check() {
        var userid = $('#userid').val();

        if (userid != "") {
            $.ajax({
                url: "{% url 'idcheck' %}",
                type: "GET",
                data: { "userid": userid },
                success: function (result) {
                    if (result == "true") {
                        alert("사용 가능한 ID 입니다.");
                        checked = true;
                    } else {
                        alert("이미 존재하는 ID 입니다.\n(" + userid + ")");
                        $('#userid').val("");
                        $('#userid').focus();
                        checked = false;
                    }
                },
                error: function (request, status, error) {
                    alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                }
            });
        } else {
            alert("ID를 입력해주세요.");
            $('#userid').focus();
        }
    }

    function sign_in() {
        if (checked) {
            var userid = $('#userid').val();
            var userpw = $('#userpw').val();
            var userpw_again = $('#userpw_again').val();
            var username = $('#username').val();
            var userphone = $('#userphone').val();

            if (userpw == "") {
                alert("비밀번호를 입력해주세요.");
                $('#userpw').focus();
            } else if (userpw_again == "") {
                alert("비밀번호를 입력해주세요.");
                $('#userpw_again').focus();
            } else if (username == "") {
                alert("이름을 입력해주세요.");
                $('#username').focus();
            } else if (userphone == "") {
                alert("전화번호를 입력해주세요.");
                $('#userphone').focus();
            } else if (userphone.length < 12 ){
                alert("전화번호를 확인해주세요.");
                $('#userphone').focus();
            } else {
                if (userpw != userpw_again) {
                    alert("비밀번호가 일치하지 않습니다.");
                    $('#userpw_again').focus();
                } else {
                    if (confirm("회원가입 하시겠습니까?")) {
                        form = document.getElementById('user_form');

                        form.submit();
                    }
                }
            }
        } else {
            alert("ID 확인을 해주세요.");
        }
    }

    var autoHypenPhone = function (str) {
        str = str.replace(/[^0-9]/g, '');
        var tmp = '';
        if (str.length < 4) {
            return str;
        } else if (str.length < 7) {
            tmp += str.substr(0, 3);
            tmp += '-';
            tmp += str.substr(3);
            return tmp;
        } else if (str.length < 11) {
            tmp += str.substr(0, 3);
            tmp += '-';
            tmp += str.substr(3, 3);
            tmp += '-';
            tmp += str.substr(6);
            return tmp;
        } else {
            tmp += str.substr(0, 3);
            tmp += '-';
            tmp += str.substr(3, 4);
            tmp += '-';
            tmp += str.substr(7);
            return tmp;
        }

        return str;
    }


    var userphone = document.getElementById('userphone');

    userphone.onkeyup = function () {
        this.value = autoHypenPhone(this.value);
    }

</script>